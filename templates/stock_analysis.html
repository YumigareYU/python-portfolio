{% extends "base.html" %}

{% block title %}è‚¡ç¥¨åˆ†æå„€è¡¨æ¿{% endblock %}

{% block content %}
<div style="max-width: 1000px; margin: 0 auto; text-align: center;">
    <h1>ğŸ“ˆ äº’å‹•å¼è‚¡åƒ¹ K ç·šåœ–</h1>

    <form method="POST" style="margin: 2rem 0; display: flex; justify-content: center; gap: 10px;">
        <input type="text" name="ticker" placeholder="è¼¸å…¥ä»£è™Ÿ (ä¾‹: NVDA, 2330.TW)" required
            style="padding: 10px; font-size: 1.2rem; width: 300px;">
        <button type="submit" class="btn">æŸ¥è©¢</button>
    </form>

    {% if error %}
    <div style="color: red; background: #fee; padding: 10px; margin-bottom: 20px;">
        âš ï¸ {{ error }}
    </div>
    {% endif %}

    <div id="chart" style="width:100%; height:600px; border:1px solid #ddd;"></div>

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    {% if graph_json %}
    <script>
        // é™¤éŒ¯æ¨¡å¼ï¼šå°‡è³‡æ–™å°åœ¨ Console
        try {
            var rawData = {{ graph_json | safe
        }};
        console.log("âœ… æˆåŠŸæ”¶åˆ°å¾Œç«¯è³‡æ–™:", rawData);

        // ç¹ªè£½åœ–è¡¨
        Plotly.newPlot('chart', rawData.data, rawData.layout);
            
        } catch (err) {
            console.error("âŒ åœ–è¡¨ç¹ªè£½å¤±æ•—:", err);
            alert("åœ–è¡¨è¼‰å…¥ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æŒ‰ F12 æŸ¥çœ‹ Console");
        }
    </script>
    {% else %}
    <p style="color: gray;">è«‹è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿä»¥é–‹å§‹æŸ¥è©¢ã€‚</p>
    {% endif %}
</div>
{% endblock %}